\subchapter{Losowo skonstruowane drzewa wyszukiwań binarnych}

\exercise %12.4-1
Sumę $\sum_{i=0}^{n-1}\binom{i+3}{3}$ zapisujemy w~równoważnej postaci $\sum_{i=3}^{n+2}\binom{i}{3}$.
Teza wynika bezpośrednio z~lematu z~rozwiązania części (f) problemu \refProblem{5-2}, dla $k=3$ i~z~$n+2$ w~miejscu $n$.

\exercise %12.4-2
Rozważmy drzewo binarne o~$n\ge16$ węzłach, w~którym początkowe poziomy stanowią pełne drzewo binarne składające się z~$n-\sqrt{n\lg n}$ węzłów (dla zwiększenia czytelności pomijamy branie części całkowitych), natomiast pozostałe $\sqrt{n\lg n}$ węzłów znajduje się na ścieżce w~dół od jednego z~węzłów z~kompletnego poziomu i~rozciąga się na $\sqrt{n\lg n}$ poziomów.
Drzewo takie ma wysokość
\[
	\Theta\bigl(\lg\bigl(n-\sqrt{n\lg n}\bigr)\bigr)+\sqrt{n\lg n} = \Theta\bigl(\!\sqrt{n\lg n}\bigr) = \omega(\lg n).
\]

O~tym, że średnia głębokość węzła w~tym drzewie wynosi $\Theta(\lg n)$, przekonamy się, wyprowadzając najpierw górne, a~potem dolne oszacowanie tej wartości.
W~oszacowaniu górnym użyjemy $O(\lg n)$ jako ograniczenia na głębokość każdego z~$n-\sqrt{n\lg n}$ węzłów z~części stanowiącej pełne drzewo binarne oraz $O\bigl(\lg n+\sqrt{n\lg n}\bigr)$ jako ograniczenia na głębokość każdego z~pozostałych $\sqrt{n\lg n}$ węzłów.
Średnia głębokość węzła w~drzewie wynosi więc co najwyżej
\[
	\frac{1}{n}\cdot O\bigl(\bigl(n-\sqrt{n\lg n}\bigr)\lg n+\sqrt{n\lg n}\,\bigl(\lg n+\sqrt{n\lg n}\bigr)\bigr) = \frac{1}{n}\cdot O(n\lg n) = O(\lg n).
\]
Z~kolei zauważmy, że najniższy poziom z~kompletem węzłów składa się z~$n-\sqrt{n\lg n}$ węzłów, z~których każdy ma głębokość $\Theta\bigl(\lg\bigl(n-\sqrt{n\lg n}\bigr)\bigr)$.
Dla $n\ge16$ zachodzi $\sqrt{n\lg n}\le n/2$, dlatego liczbę węzłów w~pełnym drzewie binarnym można ograniczyć przez $n-\sqrt{n\lg n}\ge n-n/2=\Omega(n)$, a~wysokość każdego z~nich przez $\Omega(\lg n)$.
Stąd średnia głębokość węzła ograniczona jest z~dołu przez
\[
	\frac{1}{n}\cdot\Omega(n\lg n) = \Omega(\lg n).
\]

W~drugiej części zadania udowodnimy, że wysokość drzewa binarnego o~$n$ węzłach i~średniej głębokości węzła $\Theta(\lg n)$ wynosi $O\bigl(\!\sqrt{n\lg n}\bigr)$.
Niech dane będzie drzewo binarne o~$n$ węzłach i~wysokości $h$ ze średnią głębokością węzła $\Theta(\lg n)$.
Istnieje więc ścieżka od korzenia w~dół tego drzewa, na której głębokościami węzłów są kolejno 0, 1, \dots, $h$.
Oznaczmy przez $U$ zbiór węzłów na jednej z~takich ścieżek, przez $U'$ zbiór wszystkich pozostałych węzłów drzewa, a~przez $d(x)$ głębokość węzła $x$.
Wówczas średnia głębokość węzła w~tym drzewie wynosi
\[
	\frac{1}{n}\biggl(\sum_{x\in U}d(x)+\sum_{x\in U'}d(x)\biggr) \ge \frac{1}{n}\sum_{x\in U}d(x) = \frac{1}{n}\sum_{i=0}^hi = \frac{1}{n}\cdot\Theta(h^2).
\]
Jeśli byłoby $h=\omega\bigl(\!\sqrt{n\lg n}\bigr)$, to wtedy mielibyśmy
\[
	\frac{1}{n}\cdot\Theta(h^2) = \frac{1}{n}\cdot\omega(n\lg n) = \omega(\lg n),
\]
co stoi w~sprzeczności z~założeniem, że średnią głębokością węzła jest $\Theta(\lg n)$.
A~zatem wysokość drzewa musi być ograniczona przez $O\bigl(\!\sqrt{n\lg n}\bigr)$.

\exercise %12.4-3
Istnieje 5 różnych drzew BST reprezentujących zbiór $\{1,2,3\}$, podczas gdy permutacji tego zbioru jest $3!=6$.
Jedno z~tych drzew można więc zbudować z~więcej niż jednej permutacji.
Rys.~\ref{fig:12.4-3} ilustruje każde drzewo, podając permutacje, z~których one powstają.
\begin{figure}[!ht]
	\centering \input{fig12.4-3}
	\caption{Drzewa BST powstałe w~wyniku wstawienia kluczy 1, 2, 3 w~kolejności wyznaczonej przez permutację {\sffamily\bfseries(a)} $\langle1,2,3\rangle$,
{\sffamily\bfseries(b)} $\langle1,3,2\rangle$,
{\sffamily\bfseries(c)} $\langle2,1,3\rangle$ oraz $\langle2,3,1\rangle$, {\sffamily\bfseries(d)} $\langle3,1,2\rangle$, {\sffamily\bfseries(e)} $\langle3,2,1\rangle$.} \label{fig:12.4-3}
\end{figure}

\exercise %12.4-4
Funkcja jest wypukła wtedy i~tylko wtedy, gdy jej druga pochodna istnieje i~jest nieujemna.
Dla $f(x)=2^x$, $f''(x)=2^x\ln^22>0$, a~więc funkcja $f(x)$ jest wypukła.

\exercise %12.4-5
\note{Wymagane jest założenie, że elementy tablicy wejściowej algorytmu \proc{Randomized-Quicksort} są parami różne.}

\noindent Liczba wykonywanych porównań przez algorytm \proc{Randomized-Quicksort} dla danej permutacji wejściowej zależy wyłącznie od elementów rozdzielających wybieranych losowo na każdym poziomie rekursji.
Wybór permutacji wejściowej nie wpływa więc na czas działania algorytmu.
Dowód sprowadza się do pokazania, że dla dowolnej stałej $k>0$ algorytm \proc{Randomized-Quicksort} wywołany dla dowolnych tablic wejściowych zawierających $n$ różnych liczb, w~co najwyżej $O(1/n^k)$ części wszystkich wywołań wykona $\omega(n\lg n)$ porównań.
Równoważnie należy pokazać, że prawdopodobieństwo wykonania przez algorytm $\omega(n\lg n)$ porównań dla tablicy $n$\nbhyphen elementowej wynosi $O(1/n^k)$ dla dowolnej stałej $k>0$.

Niech $T_n$ będzie zmienną losową oznaczającą liczbę porównań wykonywanych przez algorytm \proc{Randomized-Quicksort} dla tablicy o~długości $n$.
Z~analizy tego algorytmu z~podrozdziału 7.4 mamy, że $\E(T_n)=O(n\lg n)$.
Łatwo przekonać się, że dla dowolnego $k>0$ funkcja $f_k(n)=n^{1+k}\lg n$ jest klasy $\omega(n\lg n)$.
Korzystając z~nierówności Markowa (C.29), mamy:
\[
	\Pr(T_n\ge n^{1+k}\lg n) \le \frac{\E(T_n)}{n^{1+k}\lg n} = \frac{O(n\lg n)}{n^{1+k}\lg n} = O(1/n^k).
\]
Mówiąc nieformalnie, przez odpowiedni dobór stałej $k$ możemy funkcją $f_k(n)$ zbliżyć się dowolnie blisko klasy $O(n\lg n)$, pozostając nadal w~klasie $\omega(n\lg n)$.
Z~tego powodu $\Pr(T_n=O(n\lg n))=1-O(1/n^k)$, a~więc czas $O(n\lg n)$ jest osiągany przez algorytm dla wszystkich oprócz co najwyżej $O(1/n^k)$ części jego wywołań.
