\subchapter{Mnożenie ciągu macierzy}

\exercise %15.2-1
Posługując się algorytmami \proc{Matrix-Chain-Order} i~\proc{Print-Optimal-Parens}, dostajemy, że dla ciągu macierzy $\langle A_1,\dots,A_6\rangle$ o~zadanych rozmiarach, optymalnym nawiasowaniem jest $((A_1A_2)((A_3A_4)(A_5A_6)))$.
Mnożąc macierze zgodnie z~tym nawiasowaniem, wykonamy 2010 mnożeń skalarnych.

\exercise %15.2-2
Nasz algorytm oprzemy na \proc{Print-Optimal-Parens}, ale zamiast wypisywać nawiasowanie, będziemy przekazywać macierze zwrócone przez wywołania rekurencyjne do procedury odpowiedzialnej za rzeczywiste ich pomnożenie.
\begin{codebox}
\Procname{$\proc{Matrix-Chain-Multiply}(A,s,i,j)$}
\li	\If $i=j$
\li		\Then \Return $A_i$
		\End
\li	\Return $\proc{Matrix-Multiply}($
\zi	\>\>\> $\proc{Matrix-Chain-Multiply}(A,s,i,s[i,j]),$
\zi	\>\>\> $\proc{Matrix-Chain-Multiply}(A,s,s[i,j]+1,j))$
\end{codebox}

\exercise %15.2-3
Udowodnimy przez indukcję, że istnieje stała $c>0$ taka, że $P(n)\ge c2^n$ dla każdego $n\ge1$.

Okazuje się, że w~celu pokazania tego oszacowania na podstawę indukcji musimy przyjąć $n=1$, 2, 3, 4.
Mamy:
\begin{align*}
	P(1) &= 1 \ge c2^1 \quad\Leftrightarrow\quad c \le 1/2, \\
	P(2) &= P(1)P(1) = 1 \ge c2^2 \quad\Leftrightarrow\quad c \le 1/4, \\
	P(3) &= P(1)P(2)+P(2)P(1) = 1+1 = 2 \ge c2^3 \quad\Leftrightarrow\quad c \le 1/4, \\
	P(4) &= P(1)P(3)+P(2)P(2)+P(3)P(1) = 2+1+2 = 5 \ge c2^4 \quad\Leftrightarrow\quad c \le 5/16.
\end{align*}
Największym $c$ spełniającym każdą powyższą nierówność jest $c=1/4$.

Niech teraz $n\ge5$.
Dla każdego $i=1$, \dots, $n-1$ przyjmiemy, że zachodzi $P(i)\ge c2^i$.
Mamy:
\[
	P(n) = \sum_{k=1}^{n-1}P(k)P(n-k) \ge \sum_{k=1}^{n-1}c2^kc2^{n-k} = \sum_{k=1}^{n-1}c^22^n = c^22^n(n-1).
\]
Nierówność $c^22^n(n-1)\ge c2^n$ będzie zachodzić, o~ile $c\ge1/(n-1)$.
A~zatem najmniejszą wartością $c$ spełniającą tę nierówność dla wszystkich $n\ge5$, jest $c=1/4$.
Widać więc, że wybór takiego $c$ pozwala spełnić oszacowanie $P(n)\ge c2^n$ dla każdego $n$, co oznacza, że $P(n)=\Omega(2^n)$.

\exercise %15.2-4
Procedura \proc{Matrix-Chain-Order} oblicza wartości w~tablicy $m$ metodą wstępującą z~wykorzystaniem tablicowania wyników pośrednich na podstawie rekurencji (15.12).
Podczas obliczania $m[i,j]$ odczytywane są wartości z~pozycji $m[i,k]$ i~$m[k+1,j]$ -- dla ułatwienia nazwijmy je, odpowiednio, pierwszym i~drugim składnikiem.
Ustalmy $i'$ i~$j'$.
Odwołanie do $m[i',j']$ w~roli pierwszego składnika ma miejsce podczas obliczania $m[i',j'+1]$, $m[i',j'+2]$, \dots, $m[i',n]$, a~więc $n-j'$ wartości.
Z~kolei wartość $m[i',j']$ w~roli drugiego składnika służy do wyznaczenia $m[1,j']$, $m[2,j']$, \dots, $m[i'-1,j']$, czyli $i'-1$ wartości.
Stąd otrzymujemy $R(i',j')=n-j'+i'-1$.

Znajdziemy teraz całkowitą liczbę odwołań do tablicy $m$.
W~poniższym wyprowadzeniu stosujemy zamianę zmiennych w~sumie ($k=n-j$) oraz korzystamy z~tożsamości (A.1) i~(A.3):
\begin{align*}
	\sum_{i=1}^n\sum_{j=i}^nR(i,j) &= \sum_{i=1}^n\sum_{j=i}^n(n-j+i-1) \\
	&= \sum_{i=1}^n\sum_{k=0}^{n-i}(k+i-1) \\
	&= \sum_{i=1}^n\biggl(\sum_{k=0}^{n-1}k+\sum_{k=0}^{n-i}(i-1)\biggr) \\
	&= \sum_{i=1}^n\biggl(\frac{(n-i)(n-i+1)}{2}+(n-i+1)(i-1)\biggr) \\
	&= \frac{1}{2}\sum_{i=1}^n(n-i+1)(n-i+2i-2) \\
	&= \frac{1}{2}\sum_{i=1}^n(n^2-n-2+3i-i^2) \\
	&= \frac{1}{2}\biggl(n(n^2-n-2)+3\sum_{i=1}^ni-\sum_{i=1}^ni^2\biggr) \\
	&= \frac{1}{2}\biggl(n(n^2-n-2)+\frac{3n(n+1)}{2}-\frac{n(n+1)(2n+1)}{6}\biggr) \\
	&= \frac{n}{12}(6n^2-6n-12+9n+9-2n^2-3n-1) \\[1mm]
	&= \frac{n^3-n}{3}.
\end{align*}

\exercise %15.2-5
Obserwację udowodnimy przez indukcję po długości $n$ wyrażenia $\Phi$.
Jeśli $n=1$, to pojedynczy element wyrażenia $\Phi$ sam w~sobie ma ustalone pełne nawiasowanie -- występuje tu zatem 0 par nawiasów i~podstawa indukcji zachodzi.

Niech teraz $n\ge2$.
Załóżmy, że dla każdego wyrażenia o~$k<n$ elementach w~ich pełnym nawiasowaniu występuje dokładnie $k-1$ par nawiasów.
Rozważmy dowolne pełne nawiasowanie wyrażenia $\Phi$ o~$n$ elementach.
Z~definicji mamy, że istnieje $1<k<n$ takie, że wyrażenie $\Phi$ stanowi iloczyn podwyrażenia o~$k$ elementach i~podwyrażenia o~$n-k$ elementach, oba o~ustalonych pełnych nawiasowaniach.
Z~założenia mamy, że pełne nawiasowania tych podwyrażeń mają, odpowiednio, $k-1$ i~$n-k-1$ par nawiasów.
Dodając do tych liczb dodatkową parę nawiasów, która obejmuje całe wyrażenie $\Phi$, mamy, że łącznie w~nawiasowaniu $\Phi$ występuje $(k-1)+(n-k-1)+1=n-1$ par nawiasów.
