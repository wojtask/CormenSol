\ProvidesPackage{cormensol}

\RequirePackage{fancyhdr}

% potrzebne do odpowiedniego traktowania rysunków
\ifpdf
	\DeclareGraphicsRule{*}{mps}{*}{}
\fi

% definicja flagi określającej czy jesteśmy w sekcji dodatków
\newif\if@appendix
\@appendixfalse

% zapobiega wcinaniu pierwszej linii pierwszego paragrafu
\let\@afterindenttrue\@afterindentfalse
\@afterindentfalse

% odpowiednia czcionka do złożenia loga METAPOST
\font\manual=logo10

% definicje czcionek i separatorów w spisie treści
\renewcommand{\cfttoctitlefont}{\Huge\sffamily\bfseries}
\renewcommand{\cftpartfont}{\large\sffamily\bfseries}
\renewcommand{\cftpartpagefont}{\large\sffamily\bfseries}
\renewcommand{\cftchapaftersnum}{.}
\renewcommand{\cftchapfont}{\sffamily\bfseries}
\renewcommand{\cftchappagefont}{\sffamily\bfseries}
\renewcommand{\cftsecfont}{\sffamily}
\renewcommand{\cftsecleader}{\sffamily\cftdotfill{\cftsecdotsep}}
\renewcommand{\cftsecpagefont}{\sffamily}
\renewcommand{\cftaftertoctitleskip}{3cm}

% zwiększenie pudełka zawierającego numer strony w spisie treści
\renewcommand{\@pnumwidth}{1.7em}

% zwiększenie pudełka zawierającego numer rozdziału w spisie treści
\setlength{\cftchapnumwidth}{1.7em}

% zwiększenie wcięcia numeru podrozdziału w spisie treści
\setlength{\cftsecindent}{1.7em}

% zwiększenie pudełka zawierającego numer podrozdziału w spisie treści
\setlength{\cftsecnumwidth}{2.6em}

% głębokość numerowania wewnątrz spisu treści
\setcounter{tocdepth}{1}

% głębokość numerowania sekcji
\setcounter{secnumdepth}{3}

% zmiana wyglądu nagłówka części
\renewcommand{\@part}[2][default]{%
	\ifnum \c@secnumdepth >-2\relax
		\refstepcounter{part}%
		\addcontentsline{toc}{part}{\thepart\hspace{1em}#1}%
	\else
		\addcontentsline{toc}{part}{#1}%
	\fi
	\markboth{}{}%
	{%
		\interlinepenalty \@M
		\normalfont
		\ifnum \c@secnumdepth >-2\relax
			\noindent\hskip0pt\leaders\hrule height1pt \hskip10pt plus1filll \hspace{15pt}\huge\sffamily\partname\nobreakspace\bfseries\thepart
			\par
			\vskip 40\p@
		\fi
		\raggedleft\Huge \bfseries\sffamily #2\par
		\vskip 40\p@
		\rule{\textwidth}{1pt}
	}%
	\@endpart%
}

% zmiana wyglądu nagłówka rozdziału
\renewcommand{\@makechapterhead}[1]{%
	{%
		\parindent \z@ \raggedright \normalfont
		\ifnum \c@secnumdepth >\m@ne
			\if@mainmatter
				\huge\sffamily \@chapapp\nobreakspace\bfseries\thechapter \hspace{15pt}\null\nobreak\leaders\hrule height1pt \hskip10pt plus1filll\ 
				\par\nobreak
				\vskip 20\p@
			\fi
		\fi
		\interlinepenalty\@M
		\Huge \bfseries\sffamily #1\par
		\vspace{5pt}
		\if@mainmatter
			\rule{\textwidth}{1pt}
			\nobreak
			\vskip 20\p@
		\else
			\nobreak
			\vskip 40\p@
		\fi
	}%
}

% definicja polecenia tworzenia podrozdziału
\newcommand\subchapter{%
\@startsection
	{section}
	{1}
	{0mm}
	{2.5\baselineskip}
	{0.5\baselineskip}
	{\Large\sffamily}
}

% dodaje kropkę na koniec każdego numeru rozwiązania zadania i problemu
\renewcommand*{\@seccntformat}[1]{%
	\csname the#1\endcsname
	\csname adddot@#1\endcsname\quad
}
\newcommand*{\adddot@subsection}{.}

% definicja polecenia tworzenia (rozwiązania) zadania
\newcommand\ex@rcise{%
\@startsection
	{subsection}
	{2}
	{0mm}
	{-1.5\baselineskip}
	{0.5\baselineskip}
	{\sffamily\bfseries}
}
\newcommand{\exercise}{%
	\ex@rcise{}%
	\label{ex:%
	\if@appendix%
		\Alph{chapter}%
	\else%
		\arabic{chapter}%
	\fi%
	.\arabic{section}-\arabic{subsection}}%
}

% definicja polecenia tworzenia (rozwiązania) punktu zadania
\newcommand\subex@rcise{%
\@startsection
	{subsubsection}
	{3}
	{0mm}
	{\baselineskip}
	{0mm}
	{\sffamily\bfseries}
}
\newcommand{\subexercise}{\subex@rcise{}}

% odpowiedni wygląd liczników
\def\thechapter{\arabic{chapter}}
\def\thesection{\bfseries\thechapter.\arabic{section}.}
\def\thesubsection{\thechapter.\arabic{section}-\arabic{subsection}}
\def\thesubsubsection{(\alph{subsubsection})}

% redefinicja części, która sprawia, że części rozpoczynają się na nieparzystych stronach
\let\originalpart=\part
\def\part{\cleardoublepage\originalpart}

% redefinicja rozdziału, która przywraca styl licznika subsekcji na styl numerów zadań i przywraca nazwę podrozdziału na żywej paginie
\let\originalchapter=\chapter
\renewcommand{\chapter}[1]{%
	\originalchapter{#1}
	\setcounter{subsection}{0}
	\def\thesubsection{\thechapter.\arabic{section}-\arabic{subsection}}
	\lhead[\fancyplain{}{\small\sffamily\bfseries\thepage}]{\fancyplain{}{\small\sffamily\bfseries\rightmark}}
}

% kod odpowiedzialny za uczynienie numerów rysunków i tabel globalnych
\def\@removefromreset#1#2{{%
	\expandafter\let\csname c@#1\endcsname\@removefromreset
	\def\@elt##1{
		\expandafter
		\ifx
			\csname c@##1\endcsname\@removefromreset
		\else
			\noexpand\@elt{##1}
		\fi
	}
	\expandafter\xdef\csname cl@#2\endcsname{\csname cl@#2\endcsname}}
}
\@removefromreset{figure}{chapter}
\@removefromreset{table}{chapter}

% odpowiednie wyświetlanie liczników rysunków i tabel
\def\thefigure{\arabic{figure}}
\def\thetable{\arabic{table}}

% definicja zawartości żywych pagin
\pagestyle{fancyplain}
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection{} #1}{}}
\lhead[\fancyplain{}{\small\sffamily\bfseries\thepage}]{\fancyplain{}{\small\sffamily\bfseries\rightmark}}
\rhead[\fancyplain{}{\small\sffamily\bfseries\leftmark}]{\fancyplain{}{\small\sffamily\bfseries\thepage}}
\cfoot[]{}
\addtolength{\headheight}{1.6pt}

% definicja polecenia rozpoczynającego sekcję problemów
\newcommand\problems{%
	\vspace*{1.3\baselineskip}
	\section*{\sffamily\mdseries Problemy}
	\addcontentsline{toc}{section}{Problemy}
	\setcounter{subsection}{0}
	\renewcommand{\thesubsection}{\thechapter-\arabic{subsection}}
	\lhead[\fancyplain{}{\small\sffamily\bfseries\thepage}]{\fancyplain{}{\small\sffamily\bfseries Problemy}}
}

% definicja polecenia tworzącego problem wraz z jego nazwą
\newcommand{\problem}[1]{%
	\ex@rcise{#1}%
	\label{ex:%
	\if@appendix%
		\Alph{chapter}%
	\else%
		\arabic{chapter}%
	\fi%
	-\arabic{subsection}}%
}

% definicja polecenia wstawiającego podproblem
\newcommand{\subproblem}{\subex@rcise{}}

% zmienia czcionkę nagłówka bibliografii na pogrubioną bezszeryfową
\renewcommand{\bibname}{\sffamily\bfseries Bibliografia}

% niełamliwy dywiz
\newcommand{\singledash}[2]{{#1}\protect\nobreakdash-{#2}}

% niełamliwy podwójny dywiz
\newcommand{\doubledash}[2]{{#1}\protect\nobreakdash--{#2}}

% odnośnik do zadania
\newcommand{\refExercise}[1]{zad.\ \mbox{\ref{ex:#1}}}

% odnośnik do problemu
\newcommand{\refProblem}[1]{\mbox{\ref{ex:#1}}}

% informacja poboczna w tekście rozwiązania
\newcommand{\note}[1]{\noindent\emph{#1}\bigskip}

% poprawione polecenie \id dla jednoznakowych identyfikatorów
\renewcommand{\id}[1]{\ensuremath{\mathit{\text@hyphens#1}}}

% atrybut obiektu
\newcommand{\attrib}[2]{\id{#2}[\id{#1}]}

% definicja nowych operatorów matematycznych
\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\E}{E}
\DeclareMathOperator{\Var}{Var}
\DeclareMathOperator{\I}{I}

% definicja klas złożoności
\newcommand{\Pclass}{\text{P}}
\newcommand{\NPclass}{\text{NP}}
\newcommand{\coNPclass}{\text{co-NP}}